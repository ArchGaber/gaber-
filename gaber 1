/* app.js â€” Ù†Ø³Ø®Ø© Ù…ÙØµØ­Ù‘Ø­Ø© ÙˆÙ…ÙØ­Ø³Ù‘Ù†Ø©
   - Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ÙƒØ§Ù…Ù„Ø© Ù„Ù„Ø³ÙˆØ±
   - Ø¯Ø¹Ù… Ù‚Ø§Ù„Ø¨ Ù…Ø®ØµØµ: Ø¥Ù…Ø§ Ù‚Ø§Ù„Ø¨ ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ {reciterId} Ùˆ/Ø£Ùˆ {surah} Ø£Ùˆ Ø±Ø§Ø¨Ø· mp3 Ù…Ø¨Ø§Ø´Ø±
   - ØªØ¬Ø±Ø¨Ø© ØµÙŠØº Ù…ØªØ¹Ø¯Ø¯Ø© Ù„Ù„Ù€ reciterId + padding Ù„Ù„Ø³ÙˆØ±Ø©
   - Ø·Ø¨Ø§Ø¹Ø© Ù…Ø­Ø§ÙˆÙ„Ø§Øª Ø§Ù„Ø±ÙˆØ§Ø¨Ø· ÙÙŠ Console ÙˆØ¥Ø¸Ù‡Ø§Ø± Ø­Ø§Ù„Ø© Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù… (ariaStatus)
   - ØªØ¹Ù„ÙŠÙ‚Ø§Øª Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ù„Ù„Ø´Ø±Ø­
*/

/* ========== Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø³ÙˆØ± (ÙƒØ§Ù…Ù„Ø©) ========== */
const SURAH_LIST = [
  {number:1, english:"Al-FÄtiÄ¥ah", arabic:"Ø§Ù„ÙØ§ØªØ­Ø©"},
  {number:2, english:"Al-Baqarah", arabic:"Ø§Ù„Ø¨Ù‚Ø±Ø©"},
  {number:3, english:"Ä€l Ê¿ImrÄn", arabic:"Ø¢Ù„ Ø¹Ù…Ø±Ø§Ù†"},
  {number:4, english:"An-NisÄÊ¼", arabic:"Ø§Ù„Ù†Ø³Ø§Ø¡"},
  {number:5, english:"Al-MÄ'idah", arabic:"Ø§Ù„Ù…Ø§Ø¦Ø¯Ø©"},
  {number:6, english:"Al-AnÊ»Äm", arabic:"Ø§Ù„Ø£Ù†Ø¹Ø§Ù…"},
  {number:7, english:"Al-AÊ»rÄf", arabic:"Ø§Ù„Ø£Ø¹Ø±Ø§Ù"},
  {number:8, english:"Al-AnfÄl", arabic:"Ø§Ù„Ø£Ù†ÙØ§Ù„"},
  {number:9, english:"At-Tawbah", arabic:"Ø§Ù„ØªÙˆØ¨Ø©"},
  {number:10, english:"YÅ«nus", arabic:"ÙŠÙˆÙ†Ø³"},
  {number:11, english:"HÅ«d", arabic:"Ù‡ÙˆØ¯"},
  {number:12, english:"YÅ«suf", arabic:"ÙŠÙˆØ³Ù"},
  {number:13, english:"Ar-RaÊ»d", arabic:"Ø§Ù„Ø±Ø¹Ø¯"},
  {number:14, english:"IbrÄhÄ«m", arabic:"Ø¥Ø¨Ø±Ø§Ù‡ÙŠÙ…"},
  {number:15, english:"Al-á¸¤ijr", arabic:"Ø§Ù„Ø­Ø¬Ø±"},
  {number:16, english:"An-NaÄ¥l", arabic:"Ø§Ù„Ù†Ø­Ù„"},
  {number:17, english:"Al-IsrÄÊ¼", arabic:"Ø§Ù„Ø¥Ø³Ø±Ø§Ø¡"},
  {number:18, english:"Al-Kahf", arabic:"Ø§Ù„ÙƒÙ‡Ù"},
  {number:19, english:"Maryam", arabic:"Ù…Ø±ÙŠÙ…"},
  {number:20, english:"TÄ HÄ", arabic:"Ø·Ù‡"},
  {number:21, english:"Al-AnbiyÄÊ¼", arabic:"Ø§Ù„Ø£Ù†Ø¨ÙŠØ§Ø¡"},
  {number:22, english:"Al-á¸¤ajj", arabic:"Ø§Ù„Ø­Ø¬"},
  {number:23, english:"Al-MuÊ¼minÅ«n", arabic:"Ø§Ù„Ù…Ø¤Ù…Ù†ÙˆÙ†"},
  {number:24, english:"An-NÅ«r", arabic:"Ø§Ù„Ù†ÙˆØ±"},
  {number:25, english:"Al-FurqÄn", arabic:"Ø§Ù„ÙØ±Ù‚Ø§Ù†"},
  {number:26, english:"Ash-ShuÊ»arÄÊ¼", arabic:"Ø§Ù„Ø´Ø¹Ø±Ø§Ø¡"},
  {number:27, english:"An-Naml", arabic:"Ø§Ù„Ù†Ù…Ù„"},
  {number:28, english:"Al-Qaá¹£aá¹£", arabic:"Ø§Ù„Ù‚ØµØµ"},
  {number:29, english:"Al-Ê»AnkabÅ«t", arabic:"Ø§Ù„Ø¹Ù†ÙƒØ¨ÙˆØª"},
  {number:30, english:"Ar-RÅ«m", arabic:"Ø§Ù„Ø±ÙˆÙ…"},
  {number:31, english:"LuqmÄn", arabic:"Ù„Ù‚Ù…Ø§Ù†"},
  {number:32, english:"As-Sajdah", arabic:"Ø§Ù„Ø³Ø¬Ø¯Ø©"},
  {number:33, english:"Al-AÄ¥zÄb", arabic:"Ø§Ù„Ø£Ø­Ø²Ø§Ø¨"},
  {number:34, english:"SabaÊ¼", arabic:"Ø³Ø¨Ø£"},
  {number:35, english:"FÄá¹­ir", arabic:"ÙØ§Ø·Ø±"},
  {number:36, english:"YÄ SÄ«n", arabic:"ÙŠØ³"},
  {number:37, english:"Aá¹£-á¹¢ÄffÄt", arabic:"Ø§Ù„ØµØ§ÙØ§Øª"},
  {number:38, english:"á¹¢Äd", arabic:"Øµ"},
  {number:39, english:"Az-Zumar", arabic:"Ø§Ù„Ø²Ù…Ø±"},
  {number:40, english:"GÄfir / Mu'min", arabic:"ØºØ§ÙØ±"},
  {number:41, english:"Fuá¹£á¹£ilat", arabic:"ÙØµÙ„Øª"},
  {number:42, english:"Ash-ShÅ«rÄ", arabic:"Ø§Ù„Ø´ÙˆØ±Ù‰"},
  {number:43, english:"Az-Zukhruf", arabic:"Ø§Ù„Ø²Ø®Ø±Ù"},
  {number:44, english:"Ad-DukhÄn", arabic:"Ø§Ù„Ø¯Ø®Ø§Ù†"},
  {number:45, english:"Al-JÄthiyah", arabic:"Ø§Ù„Ø¬Ø§Ø«ÙŠØ©"},
  {number:46, english:"Al-AÄ¥qÄf", arabic:"Ø§Ù„Ø£Ø­Ù‚Ø§Ù"},
  {number:47, english:"MuÄ¥ammad", arabic:"Ù…Ø­Ù…Ø¯"},
  {number:48, english:"Al-FatÄ¥", arabic:"Ø§Ù„ÙØªØ­"},
  {number:49, english:"Al-á¸¤ujurÄt", arabic:"Ø§Ù„Ø­Ø¬Ø±Ø§Øª"},
  {number:50, english:"QÄf", arabic:"Ù‚"},
  {number:51, english:"Aáº“-áº’ÄriyÄt", arabic:"Ø§Ù„Ø°Ø§Ø±ÙŠØ§Øª"},
  {number:52, english:"Aá¹­-á¹¬Å«r", arabic:"Ø§Ù„Ø·ÙˆØ±"},
  {number:53, english:"An-NaÄµm", arabic:"Ø§Ù„Ù†Ø¬Ù…"},
  {number:54, english:"Al-Qamar", arabic:"Ø§Ù„Ù‚Ù…Ø±"},
  {number:55, english:"Ar-RaÄ¥mÄn", arabic:"Ø§Ù„Ø±Ø­Ù…Ù†"},
  {number:56, english:"Al-WÄqiÊ»ah", arabic:"Ø§Ù„ÙˆØ§Ù‚Ø¹Ø©"},
  {number:57, english:"Al-Ä¤adÄ«d", arabic:"Ø§Ù„Ø­Ø¯ÙŠØ¯"},
  {number:58, english:"Al-MujÄdilah", arabic:"Ø§Ù„Ù…Ø¬Ø§Ø¯Ù„Ø©"},
  {number:59, english:"Al-á¸¤ashr", arabic:"Ø§Ù„Ø­Ø´Ø±"},
  {number:60, english:"Al-MumtaÄ¥anah", arabic:"Ø§Ù„Ù…Ù…ØªØ­Ù†Ø©"},
  {number:61, english:"AÅŸ-Åaff", arabic:"Ø§Ù„ØµÙ"},
  {number:62, english:"Al-JumuÊ»ah", arabic:"Ø§Ù„Ø¬Ù…Ø¹Ø©"},
  {number:63, english:"Al-MunÄfiqÅ«n", arabic:"Ø§Ù„Ù…Ù†Ø§ÙÙ‚ÙˆÙ†"},
  {number:64, english:"At-TaghÄbun", arabic:"Ø§Ù„ØªØºØ§Ø¨Ù†"},
  {number:65, english:"Aá¹­-Å¢alÄq", arabic:"Ø§Ù„Ø·Ù„Ø§Ù‚"},
  {number:66, english:"At-TaÄ¥rÄ«m", arabic:"Ø§Ù„ØªØ­Ø±ÙŠÙ…"},
  {number:67, english:"Al-Mulk", arabic:"Ø§Ù„Ù…Ù„Ùƒ"},
  {number:68, english:"Al-Qalam", arabic:"Ø§Ù„Ù‚Ù„Ù…"},
  {number:69, english:"Al-Ä¤Äqqah", arabic:"Ø§Ù„Ø­Ø§Ù‚Ø©"},
  {number:70, english:"Al-MaÊ»Ärij", arabic:"Ø§Ù„Ù…Ø¹Ø§Ø±Ø¬"},
  {number:71, english:"NÅ«Ä¥", arabic:"Ù†ÙˆØ­"},
  {number:72, english:"Al-Jinn", arabic:"Ø§Ù„Ø¬Ù†"},
  {number:73, english:"Al-Muzzammil", arabic:"Ø§Ù„Ù…Ø²Ù…Ù„"},
  {number:74, english:"Al-Mudaththir", arabic:"Ø§Ù„Ù…Ø¯Ø«Ø±"},
  {number:75, english:"Al-QiyÄmah", arabic:"Ø§Ù„Ù‚ÙŠØ§Ù…Ø©"},
  {number:76, english:"Al-InsÄn", arabic:"Ø§Ù„Ø§Ù†Ø³Ø§Ù†"},
  {number:77, english:"Al-MursalÄt", arabic:"Ø§Ù„Ù…Ø±Ø³Ù„Ø§Øª"},
  {number:78, english:"An-NabaÊ¼", arabic:"Ø§Ù„Ù†Ø¨Ø£"},
  {number:79, english:"An-NÄziÊ»Ät", arabic:"Ø§Ù„Ù†Ø§Ø²Ø¹Ø§Øª"},
  {number:80, english:"Ê»Abasa", arabic:"Ø¹Ø¨Ø³"},
  {number:81, english:"At-TakwÄ«r", arabic:"Ø§Ù„ØªÙƒÙˆÙŠØ±"},
  {number:82, english:"Al-InfiÅ£Är", arabic:"Ø§Ù„Ø§Ù†ÙØ·Ø§Ø±"},
  {number:83, english:"Al-MuÅ£affifÄ«n", arabic:"Ø§Ù„Ù…Ø·ÙÙÙŠÙ†"},
  {number:84, english:"Al-InshiqÄq", arabic:"Ø§Ù„Ø§Ù†Ø´Ù‚Ø§Ù‚"},
  {number:85, english:"Al-BurÅ«j", arabic:"Ø§Ù„Ø¨Ø±ÙˆØ¬"},
  {number:86, english:"AÅ£-Å¢Äriq", arabic:"Ø§Ù„Ø·Ø§Ø±Ù‚"},
  {number:87, english:"Al-AÊ»lÄ", arabic:"Ø§Ù„Ø£Ø¹Ù„Ù‰"},
  {number:88, english:"Al-GhÄshiyah", arabic:"Ø§Ù„ØºØ§Ø´ÙŠØ©"},
  {number:89, english:"Al-Fajr", arabic:"Ø§Ù„ÙØ¬Ø±"},
  {number:90, english:"Al-Balad", arabic:"Ø§Ù„Ø¨Ù„Ø¯"},
  {number:91, english:"Ash-Shams", arabic:"Ø§Ù„Ø´Ù…Ø³"},
  {number:92, english:"Al-Layl", arabic:"Ø§Ù„Ù„ÙŠÙ„"},
  {number:93, english:"Ad-Duá¸¥Ä", arabic:"Ø§Ù„Ø¶Ø­Ù‰"},
  {number:94, english:"Ash-SharÄ¥", arabic:"Ø§Ù„Ø´Ø±Ø­"},
  {number:95, english:"At-TÄ«n", arabic:"Ø§Ù„ØªÙŠÙ†"},
  {number:96, english:"Al-Ê»Alaq", arabic:"Ø§Ù„Ø¹Ù„Ù‚"},
  {number:97, english:"Al-Qadr", arabic:"Ø§Ù„Ù‚Ø¯Ø±"},
  {number:98, english:"Al-Bayyinah", arabic:"Ø§Ù„Ø¨ÙŠÙ†Ø©"},
  {number:99, english:"Az-Zalzalah", arabic:"Ø§Ù„Ø²Ù„Ø²Ù„Ø©"},
  {number:100, english:"Al-Ê»Ä€diyÄt", arabic:"Ø§Ù„Ø¹Ø§Ø¯ÙŠØ§Øª"},
  {number:101, english:"Al-QÄriÊ»ah", arabic:"Ø§Ù„Ù‚Ø§Ø±Ø¹Ø©"},
  {number:102, english:"At-TakÄthur", arabic:"Ø§Ù„ØªÙƒØ§Ø«Ø±"},
  {number:103, english:"Al-Ê»AÅŸr", arabic:"Ø§Ù„Ø¹ØµØ±"},
  {number:104, english:"Al-Humazah", arabic:"Ø§Ù„Ù‡Ù…Ø²Ø©"},
  {number:105, english:"Al-FÄ«l", arabic:"Ø§Ù„ÙÙŠÙ„"},
  {number:106, english:"Quraysh", arabic:"Ù‚Ø±ÙŠØ´"},
  {number:107, english:"Al-MÄÊ»Å«n", arabic:"Ø§Ù„Ù…Ø§Ø¹ÙˆÙ†"},
  {number:108, english:"Al-Kawthar", arabic:"Ø§Ù„ÙƒÙˆØ«Ø±"},
  {number:109, english:"Al-KÄfirÅ«n", arabic:"Ø§Ù„ÙƒØ§ÙØ±ÙˆÙ†"},
  {number:110, english:"An-NaÅŸr", arabic:"Ø§Ù„Ù†ØµØ±"},
  {number:111, english:"Al-Masad", arabic:"Ø§Ù„Ù…Ø³Ø¯"},
  {number:112, english:"Al-IkhlÄá¹£", arabic:"Ø§Ù„Ø¥Ø®Ù„Ø§Øµ"},
  {number:113, english:"Al-Falaq", arabic:"Ø§Ù„ÙÙ„Ù‚"},
  {number:114, english:"An-NÄs", arabic:"Ø§Ù„Ù†Ø§Ø³"}
];

/* ========== Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´ÙŠÙˆØ® (Ø£Ù…Ø«Ù„Ø©) ========== */
const RECITERS = [
  { id: "ar.abdulrahman_sudais", name: "Ø§Ù„Ø´ÙŠØ® Ø¹Ø¨Ø¯ Ø§Ù„Ø±Ø­Ù…Ù† Ø§Ù„Ø³Ø¯ÙŠØ³", info: "Ø¥Ù…Ø§Ù… Ø§Ù„Ø­Ø±Ù… Ø§Ù„Ù…ÙƒÙŠØŒ ØªÙ„Ø§ÙˆØ© ÙˆØ§Ø¶Ø­Ø© ÙˆÙ…Ø¤Ø«Ø±Ø©." },
  { id: "ar.saad_alghamidi", name: "Ø§Ù„Ø´ÙŠØ® Ø³Ø¹Ø¯ Ø§Ù„ØºØ§Ù…Ø¯ÙŠ", info: "ØªÙ„Ø§ÙˆØ© Ù…ÙØ±ØµÙ‘ÙØ© ÙˆØ¬Ù…ÙŠÙ„Ø©." },
  { id: "ar.mishary_alafasy", name: "Ø§Ù„Ø´ÙŠØ® Ù…Ø´Ø§Ø±ÙŠ Ø±Ø§Ø´Ø¯ Ø§Ù„Ø¹ÙØ§Ø³ÙŠ", info: "ØµÙˆØª Ù…Ø­Ø¨ÙˆØ¨ ÙˆÙ…Ø¤Ø«Ø±." },
  { id: "ar.abdulbasit_murattal", name: "Ø§Ù„Ø´ÙŠØ® Ø¹Ø¨Ø¯ Ø§Ù„Ø¨Ø§Ø³Ø· Ø¹Ø¨Ø¯ Ø§Ù„ØµÙ…Ø¯", info: "Ù…Ù† Ø£Ø¹Ø¸Ù… Ø§Ù„Ù‚Ø±Ù‘Ø§Ø¡." },
  { id: "ar.husary_mujawwad", name: "Ø§Ù„Ø´ÙŠØ® Ù…Ø­Ù…ÙˆØ¯ Ø®Ù„ÙŠÙ„ Ø§Ù„Ø­ØµØ±ÙŠ", info: "ØªØ¬ÙˆÙŠØ¯ Ù…ØªÙ…ÙŠØ²." },
  { id: "ar.saood_shuraym", name: "Ø§Ù„Ø´ÙŠØ® Ø³Ø¹ÙˆØ¯ Ø§Ù„Ø´Ø±ÙŠÙ…", info: "Ø¥Ù…Ø§Ù… Ø§Ù„Ø­Ø±Ù… â€” ØªÙ„Ø§ÙˆØ© Ø±ØµÙŠÙ†Ø©." },
  { id: "ar.abdurrahman_alsudais", name: "Ø¹Ø¨Ø¯ Ø§Ù„Ø±Ø­Ù…Ù† Ø§Ù„Ø³Ø¯ÙŠØ³ (Ù†Ø³Ø®Ø©)", info: "Ù†Ø³Ø®Ø© Ø«Ø§Ù†ÙŠØ© Ù„ØªØ¬Ø±Ø¨Ø© slugs Ù…Ø®ØªÙ„ÙØ©." },
  { id: "ar.minshawi", name: "Ø§Ù„Ø´ÙŠØ® Ù…Ø­Ù…Ø¯ ØµØ¯ÙŠÙ‚ Ø§Ù„Ù…Ù†Ø´Ø§ÙˆÙŠ", info: "ØªØ±ØªÙŠÙ„ Ù‡Ø§Ø¯Ø¦ ÙˆÙ…Ø¤Ø«Ø±." },
  { id: "ar.shaatree", name: "Ø§Ù„Ø´ÙŠØ® Ù…Ø­Ù…Ø¯ Ø´Ø§ÙƒØ±Ø© (Ù…Ø«Ø§Ù„)", info: "Ù‚Ø§Ø±Ø¦ Ø¥Ø¶Ø§ÙÙŠ Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù‚ÙˆØ§Ù„Ø¨." },
  { id: "ar.hani_rafaie", name: "Ø§Ù„Ø´ÙŠØ® Ù‡Ø§Ù†ÙŠ Ø§Ù„Ø±ÙØ§Ø¹ÙŠ", info: "Ù†Ù…Ø· ØªÙ„Ø§ÙˆØ© Ù…Ø®ØªÙ„Ù." },
  { id: "ar.ismail_raqee", name: "Ø§Ù„Ø´ÙŠØ® Ø¥Ø³Ù…Ø§Ø¹ÙŠÙ„ Ø±Ù‚ÙŠ", info: "Ù‚Ø§Ø±Ø¦ Ø§Ø­ØªÙŠØ§Ø·ÙŠ" }
];

/* Ù‚Ø§Ù„Ø¨ Ø§ÙØªØ±Ø§Ø¶ÙŠ (ÙŠÙ…ÙƒÙ† ØªØºÙŠÙŠØ±Ù‡ ÙÙŠ Settings) */
const DEFAULT_TEMPLATE = "https://cdn.islamic.network/quran/audio/128/{reciterId}/{surah}.mp3";

/* ========== Ø­Ø§Ù„Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ========== */
const state = {
  reciters: RECITERS,
  surahs: SURAH_LIST,
  selectedReciterIndex: 0,
  selectedSurahIndex: -1,
  recitationType: "murattal",
  customTemplate: "",
  autoAdvance: false,
  useLocalAudio: true,
  repeatMode: "off",
  audio: null,
  isPlaying: false
};

/* ========== Ù…Ø³Ø§Ø¹Ø¯Ø§Øª ØµØºÙŠØ±Ø© ========== */
function padSurah(n){ return String(n).padStart(3,"0"); }
function formatTime(s){ if (!isFinite(s)) return "0:00"; const m = Math.floor(s/60); const sec = Math.floor(s%60).toString().padStart(2,"0"); return `${m}:${sec}`; }

/* ========== DOM refs ========== */
const reciterSelect = document.getElementById("reciterSelect");
const typeSelect = document.getElementById("typeSelect");
const surahListEl = document.getElementById("surahList");
const surahNumberEl = document.getElementById("surahNumber");
const surahNameEl = document.getElementById("surahName");
const surahNameArabicEl = document.getElementById("surahNameArabic");
const selectedReciterEl = document.getElementById("selectedReciter");
const selectedTypeEl = document.getElementById("selectedType");
const reciterInfoEl = document.getElementById("reciterInfo");
const audioEl = document.getElementById("audio");
const playPauseBtn = document.getElementById("playPauseBtn");
const stopBtn = document.getElementById("stopBtn");
const prevBtn = document.getElementById("prevBtn");
const nextBtn = document.getElementById("nextBtn");
const progressInput = document.getElementById("progress");
const currentTimeEl = document.getElementById("currentTime");
const durationEl = document.getElementById("duration");
const volumeInput = document.getElementById("volume");
const speedSelect = document.getElementById("speed");
const repeatBtn = document.getElementById("repeatBtn");
const themeToggle = document.getElementById("themeToggle");
const searchInput = document.getElementById("search");
const settingsDialog = document.getElementById("settingsDialog");
const openSettingsBtn = document.getElementById("openSettings");
const customTemplateInput = document.getElementById("customTemplate");
const autoAdvanceInput = document.getElementById("autoAdvance");
const ariaStatus = document.getElementById("ariaStatus");
const useLocalAudioInput = document.getElementById("useLocalAudio");
const localFilesStatusEl = document.getElementById("localFilesStatus");

/* ========== Ø¯Ø§Ù„Ø© Ø§Ø®ØªØ¨Ø§Ø± Ø±Ø§Ø¨Ø· mp3 (ØªØ¹ÙŠØ¯ Promise<boolean>) ========== */
function testAudioUrl(url, timeout = 6000){
  return new Promise((resolve) => {
    const a = new Audio();
    a.preload = "metadata";
    a.crossOrigin = "anonymous";
    a.src = url;
    let settled = false;
    function finish(ok){
      if (settled) return;
      settled = true;
      try{ a.pause(); } catch(e){}
      a.src = "";
      resolve(ok);
    }
    a.addEventListener("canplay", () => finish(true), {once:true});
    a.addEventListener("loadedmetadata", () => finish(true), {once:true});
    a.addEventListener("error", () => finish(false), {once:true});
    setTimeout(() => finish(false), timeout);
  });
}

/* ========== Ù„Ùˆ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙˆØ¶Ø¹ Ø±Ø§Ø¨Ø· mp3 ÙƒØ§Ù…Ù„ ÙÙŠ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù†Ø³ØªØ®Ø¯Ù…Ù‡ Ù…Ø¨Ø§Ø´Ø±Ø© ========== */
function isDirectMp3Template(t){
  if (!t) return false;
  const trimmed = t.trim();
  // Ø§Ø¹ØªØ¨Ø±Ù‡ Ø±Ø§Ø¨Ø· Ù…Ø¨Ø§Ø´Ø± Ù„Ùˆ ÙŠØ­ÙˆÙŠ http Ùˆ ÙŠØªÙ…Ø§Ø«Ù„ Ù…Ø¹ .mp3 Ø£Ùˆ ÙŠØ­ØªÙˆÙŠ {surah} Ùˆ Ù„Ø§ ÙŠØ­ØªÙˆÙŠ {reciterId} => Ù‚Ø¯ ÙŠÙƒÙˆÙ† Ù‚Ø§Ù„Ø¨ Ù„Ù„Ø³ÙˆØ±Ø© ÙÙ‚Ø·
  if (/^https?:\/\/.+\.mp3($|\?)/i.test(trimmed)) return true;
  return false;
}

// Ù…Ø³Ø§Ø¹Ø¯Ø© Ø³Ø±ÙŠØ¹Ø© Ù„Ø§Ø®ØªØ¨Ø§Ø± Ù…Ø§ Ø¥Ø°Ø§ ÙƒØ§Ù† Ù„Ø¯ÙŠÙ†Ø§ Ø±Ø§Ø¨Ø· Ù…Ø­Ù„ÙŠ Ù…ØªÙˆÙ‚Ø¹
function getLocalSurahUrl(n){ return `sound/${padSurah(n)}.mp3`; }

// ÙŠÙØ­Øµ ÙˆØ¬ÙˆØ¯ Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ© ÙÙŠ Ø§Ù„Ø®Ù„ÙÙŠØ© ÙˆÙŠØ­Ø¯Ù‘Ø« localFilesStatusEl
async function scanLocalFiles(){
  if (!state.useLocalAudio) {
    if (localFilesStatusEl) localFilesStatusEl.textContent = 'Local files usage disabled in settings.';
    return;
  }
  const total = state.surahs.length;
  let found = 0;
  for (let i=1;i<=total;i++){
    try{
      const url = getLocalSurahUrl(i);
      const ok = await testAudioUrl(url, 1200);
      if (ok){ state.localAvailable = state.localAvailable || {}; state.localAvailable[i]=true; found++; }
    }catch(e){ /* ignore */ }
    if (i % 20 === 0 && localFilesStatusEl) localFilesStatusEl.textContent = `Local files: checked ${i}/${total} â€” found ${found}`;
  }
  if (localFilesStatusEl) localFilesStatusEl.textContent = `Local files: ${found}/${total} available.`;
  console.log('[scanLocalFiles] found local files:', found);
}

/* ========== ØªØ¬Ø±Ø¨Ø© ØµÙŠØº Ù…ØªØ¹Ø¯Ø¯Ø© Ù„ÙÙ€ reciterId Ùˆ surah ========== */
async function findWorkingAudioUrl(reciterId, surahNumber){
  const template = state.customTemplate && state.customTemplate.trim().length>5 ? state.customTemplate.trim() : DEFAULT_TEMPLATE;

  // 1) Ø¥Ø°Ø§ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙŠØ³Ù…Ø­ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ© ÙˆÙ†Ù…Ù„Ùƒ Ù†ØªÙŠØ¬Ø© Ù…ÙØ³Ø¨Ù‚ÙØ© Ø§Ø³ØªØ®Ø¯Ù…Ù‡Ø§ ÙÙˆØ±Ø§Ù‹
  if (state.useLocalAudio && state.localAvailable && state.localAvailable[surahNumber]){
    const url = getLocalSurahUrl(surahNumber);
    console.log('[audio-test] Using cached local file for', surahNumber, url);
    return { ok:true, url };
  }

  // 2) Ø¬Ø±Ø¨ Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ© Ø§Ù„Ø³Ø±ÙŠØ¹Ø© (timeout Ù‚ØµÙŠØ±) Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù…ÙØ¹Ù‘Ù„Ø©
  if (state.useLocalAudio){
    try {
      const surahFormsLocal = [padSurah(surahNumber), String(surahNumber)];
      for (const sForm of surahFormsLocal) {
        const candidates = [`sound/${sForm}.mp3`, `./sound/${sForm}.mp3`, `sound/${sForm}.wav`, `./sound/${sForm}.wav`];
        for (const url of candidates) {
          console.log("[audio-test] Trying local URL:", url);
          try {
            const ok = await testAudioUrl(url, 2000);
            if (ok) {
              state.localAvailable = state.localAvailable || {};
              state.localAvailable[surahNumber] = true;
              return { ok:true, url };
            }
          } catch (e) { /* ignore */ }
        }
      }
    } catch (e) { console.warn("[audio-test] local check failed", e); }
  }

  // Ø¥Ù† Ø§Ù„Ù‚Ø§Ù„Ø¨ Ù‡Ùˆ Ø±Ø§Ø¨Ø· mp3 Ù…Ø¨Ø§Ø´Ø± (Ù…Ø«Ù„Ø§Ù‹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø£Ø¶Ø§Ù Ø±Ø§Ø¨Ø· Ù„Ù…Ù„Ù ÙˆØ§Ø­Ø¯) ÙØ±ÙƒÙ‘Ø² Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø¹Ù„ÙŠÙ‡ Ù…Ø¨Ø§Ø´Ø±Ø©:
  if (isDirectMp3Template(template)){
    console.log("[audio-test] Using direct mp3 template:", template);
    // Ù„Ùˆ Ø§Ù„Ù‚Ø§Ù„Ø¨ Ù„Ø§ ÙŠØ­ØªÙˆÙŠ Ù…ØªØºÙŠØ±ØŒ Ø§Ø³ØªØ®Ø¯Ù…Ù‡ ÙƒÙ…Ø§ Ù‡Ùˆ
    const ok = await testAudioUrl(template, 6000);
    return ok ? { ok:true, url: template } : { ok:false, url:null };
  }

  // Ø¥Ù† Ø§Ù„Ù‚Ø§Ù„Ø¨ ÙŠØ­ØªÙˆÙŠ {reciterId} Ø£Ùˆ {surah} Ø³Ù†Ø³ØªØ¨Ø¯Ù„
  const variants = [];
  variants.push(reciterId);
  variants.push(reciterId.replace(/^ar\./i,""));
  if (reciterId.includes(".")) variants.push(reciterId.split(".").pop());
  variants.push(reciterId.replace(/\./g,"_"));
  variants.push(reciterId.replace(/\./g,"-"));
  variants.push(reciterId.toLowerCase());
  const uniqVariants = [...new Set(variants)];

  const surahForms = [padSurah(surahNumber), String(surahNumber)];
  for (const v of uniqVariants){
    for (const sForm of surahForms){
      const url = template.replace(/{reciterId}/g, v).replace(/{surah}/g, sForm).replace(/{number}/g, String(surahNumber));
      console.log("[audio-test] Trying URL:", url);
      try {
        const ok = await testAudioUrl(url, 5000);
        if (ok) return { ok:true, url };
      } catch (e) {
        console.warn("[audio-test] error testing", url, e);
      }
    }
  }
  return { ok:false, url:null };
}

/* ========== init UI & events ========== */
function init(){
  // populate reciters select
  reciterSelect.innerHTML = "";
  state.reciters.forEach((r, idx) => {
    const opt = document.createElement("option");
    opt.value = idx;
    opt.textContent = r.name;
    reciterSelect.appendChild(opt);
  });

  // populate surah list
  surahListEl.innerHTML = "";
  for (const s of state.surahs){
    const btn = document.createElement("button");
    btn.className = "surah";
    btn.type = "button";
    btn.setAttribute("data-number", s.number);
    btn.innerHTML = `<div class="num">${s.number}</div><div class="names"><div>${s.english}</div><div class="arab">${s.arabic}</div></div>`;
    btn.addEventListener("click", () => selectSurahByNumber(s.number));
    surahListEl.appendChild(btn);
  }

  // init reciter display
  updateSelectedReciter(0);
  updateRecitationType(typeSelect.value);

  // populate reciter grid (cards)
  const reciterGrid = document.getElementById('reciterGrid');
  if (reciterGrid){
    reciterGrid.innerHTML = '';
    state.reciters.forEach((r, idx) => {
      const card = document.createElement('button');
      card.className = 'reciter-card';
      card.type = 'button';
      card.setAttribute('data-idx', idx);
      const avatar = document.createElement('div'); avatar.className='reciter-avatar';
      // initials or icon
      const initials = r.name.split(' ').slice(0,2).map(x=>x[0]||'').join('').toUpperCase();
      avatar.textContent = initials || 'Ù‚';
      const meta = document.createElement('div'); meta.className='reciter-meta';
      const nm = document.createElement('div'); nm.className='reciter-name'; nm.textContent = r.name;
      const info = document.createElement('div'); info.className='reciter-info'; info.textContent = r.info;
      meta.appendChild(nm); meta.appendChild(info);
      card.appendChild(avatar); card.appendChild(meta);
      card.addEventListener('click', ()=>{
        updateSelectedReciter(idx);
        card.classList.add('pulse'); setTimeout(()=>card.classList.remove('pulse'),900);
      });
      reciterGrid.appendChild(card);
    });
  }

  // audio setup
  state.audio = audioEl;
  audioEl.volume = parseFloat(volumeInput.value);
  audioEl.crossOrigin = "anonymous";

  // Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ© Ø¥Ù† ÙˆÙØ¬Ø¯
  const savedUseLocal = localStorage.getItem('ql_useLocalAudio');
  if (savedUseLocal !== null) state.useLocalAudio = savedUseLocal === '1';
  if (useLocalAudioInput) useLocalAudioInput.checked = state.useLocalAudio;

  // Ø¨Ø¯Ø¡ ÙØ­Øµ Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ© ÙÙŠ Ø§Ù„Ø®Ù„ÙÙŠØ©
  state.localAvailable = {};
  scanLocalFiles();

  progressInput.dragging = false;

  attachEventListeners();

  announce("Ø¬Ø§Ù‡Ø². Ø§Ø®ØªØ± Ø³ÙˆØ±Ø© ÙˆÙ‚Ø§Ø±Ø¦ Ù„Ø¨Ø¯Ø¡ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±.");
}

function attachEventListeners(){
  reciterSelect.addEventListener("change", (e) => updateSelectedReciter(parseInt(e.target.value)));
  typeSelect.addEventListener("change", (e) => updateRecitationType(e.target.value));
  playPauseBtn.addEventListener("click", togglePlayPause);
  stopBtn.addEventListener("click", stopPlayback);
  prevBtn.addEventListener("click", playPrevious);
  nextBtn.addEventListener("click", playNext);

  audioEl.addEventListener("loadedmetadata", () => {
    durationEl.textContent = formatTime(audioEl.duration);
    progressInput.max = audioEl.duration || 0;
  });
  audioEl.addEventListener("timeupdate", () => {
    currentTimeEl.textContent = formatTime(audioEl.currentTime);
    if (!progressInput.dragging) progressInput.value = audioEl.currentTime;
  });
  audioEl.addEventListener("ended", onAudioEnded);
  audioEl.addEventListener("error", (e) => {
    console.error("Audio element error:", e);
    ariaStatus.textContent = "Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ´ØºÙŠÙ„ Ø§Ù„Ù…Ù„Ù Ø§Ù„ØµÙˆØªÙŠ. Ø±Ø§Ø¬Ø¹ Console / Network.";
    announce("Ø®Ø·Ø£ ÙÙŠ ØªØ´ØºÙŠÙ„ Ø§Ù„Ù…Ù„Ù Ø§Ù„ØµÙˆØªÙŠ. Ø±Ø§Ø¬Ø¹ Console.");
  });

  progressInput.addEventListener("input", () => { progressInput.dragging = true; });
  progressInput.addEventListener("change", (e) => { state.audio.currentTime = parseFloat(e.target.value); progressInput.dragging = false; });

  volumeInput.addEventListener("input", (e) => { audioEl.volume = parseFloat(e.target.value); });
  speedSelect.addEventListener("change", (e) => { audioEl.playbackRate = parseFloat(e.target.value); });

  repeatBtn.addEventListener("click", cycleRepeat);

  themeToggle.addEventListener("click", toggleTheme);
  const savedTheme = localStorage.getItem("ql_theme");
  if (savedTheme) setTheme(savedTheme);

  document.addEventListener("keydown", onKeyDown);
  searchInput.addEventListener("input", onSearch);

  openSettingsBtn.addEventListener("click", () => {
    customTemplateInput.value = state.customTemplate || "";
    autoAdvanceInput.checked = state.autoAdvance;
    if (useLocalAudioInput) useLocalAudioInput.checked = state.useLocalAudio;
    settingsDialog.showModal();
  });
  document.getElementById("settingsForm").addEventListener("submit", (ev) => {
    ev.preventDefault();
    state.customTemplate = customTemplateInput.value.trim();
    state.autoAdvance = autoAdvanceInput.checked;
    if (useLocalAudioInput) state.useLocalAudio = useLocalAudioInput.checked;
    localStorage.setItem('ql_useLocalAudio', state.useLocalAudio ? '1' : '0');
    settingsDialog.close();
    announce("ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª.");
  });
  document.getElementById("cancelSettings").addEventListener("click", () => settingsDialog.close());
}

/* ========== ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„ØªØ­Ø¯ÙŠØ« ========== */
function updateSelectedReciter(index){
  state.selectedReciterIndex = index;
  reciterSelect.value = index;
  const r = state.reciters[index];
  selectedReciterEl.textContent = r.name;
  reciterInfoEl.textContent = r.info;
  // highlight selected card if grid exists
  const reciterGrid = document.getElementById('reciterGrid');
  if (reciterGrid){
    const cards = reciterGrid.querySelectorAll('.reciter-card');
    cards.forEach(c=> c.classList.toggle('selected', parseInt(c.getAttribute('data-idx'))===index));
  }
  announce(`ØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù‚Ø§Ø±Ø¦ ${r.name}`);
  if (state.selectedSurahIndex >= 0) loadSurah(state.surahs[state.selectedSurahIndex].number);
}
function updateRecitationType(type){
  state.recitationType = type;
  selectedTypeEl.textContent = type === "murattal" ? "Murattal" : "Mujawwad";
  announce(`Ù†ÙˆØ¹ Ø§Ù„ØªÙ„Ø§ÙˆØ©: ${selectedTypeEl.textContent}`);
  if (state.selectedSurahIndex >= 0) loadSurah(state.surahs[state.selectedSurahIndex].number);
}
function selectSurahByNumber(n){
  const idx = state.surahs.findIndex(s => s.number === n);
  if (idx === -1) return;
  state.selectedSurahIndex = idx;
  updateNowPlaying(idx);
  loadSurah(n);
}
function updateNowPlaying(idx){
  const s = state.surahs[idx];
  surahNumberEl.textContent = s.number;
  surahNameEl.textContent = s.english;
  surahNameArabicEl.textContent = s.arabic;
}

/* ========== ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø³ÙˆØ±Ø© â€” Ù…Ø¹ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù‚ÙˆØ§Ù„Ø¨ ========== */
async function loadSurah(surahNumber){
  const reciter = state.reciters[state.selectedReciterIndex];
  announce(`Ø§Ø®ØªØ¨Ø§Ø± Ø±Ø§Ø¨Ø· Ø§Ù„Ø³ÙˆØ±Ø© ${surahNumber} Ù„Ù„Ù‚Ø§Ø±Ø¦ ${reciter.name}...`);
  ariaStatus.textContent = `Ø§Ø®ØªØ¨Ø§Ø± Ø±ÙˆØ§Ø¨Ø· Ø§Ù„ØµÙˆØª...`;

  // Ø¥Ø°Ø§ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙˆØ¶Ø¹ Ø±Ø§Ø¨Ø· mp3 Ù…Ø¨Ø§Ø´Ø± ÙÙŠ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§ØªØŒ Ù†Ø³ØªØ®Ø¯Ù…Ù‡ ÙƒÙ…Ø§ Ù‡Ùˆ (Ù…ÙÙŠØ¯ Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø±)
  if (isDirectMp3Template(state.customTemplate)){
    const directUrl = state.customTemplate.trim();
    console.log("[loadSurah] using direct mp3 from settings:", directUrl);
    audioEl.src = directUrl;
    audioEl.load();
    announce("ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø±Ø§Ø¨Ø· MP3 Ø§Ù„Ù…Ø¨Ø§Ø´Ø± Ù…Ù† Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§ØªØŒ Ø§Ø¶ØºØ· ØªØ´ØºÙŠÙ„.");
    return;
  }

  // ØºÙŠØ± Ø°Ù„ÙƒØŒ Ù†Ø­Ø§ÙˆÙ„ Ø¥ÙŠØ¬Ø§Ø¯ Ø±Ø§Ø¨Ø· ØµØ§Ù„Ø­ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ù‚Ø§Ù„Ø¨/variants
  const result = await findWorkingAudioUrl(reciter.id, surahNumber);

  if (result.ok && result.url){
    audioEl.src = result.url;
    audioEl.load();
    progressInput.value = 0;
    currentTimeEl.textContent = "0:00";
    durationEl.textContent = "0:00";
    ariaStatus.textContent = `Loaded: ${result.url}`;
    announce("ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ù. Ø§Ø¶ØºØ· ØªØ´ØºÙŠÙ„ Ù„Ø¨Ø¯Ø¡ Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹.");
    console.log("[loadSurah] Loaded audio URL:", result.url);
  } else {
    audioEl.src = "";
    ariaStatus.textContent = `Ù„Ù… Ù†ØªÙ…ÙƒÙ† Ù…Ù† Ø¥ÙŠØ¬Ø§Ø¯ Ù…Ù„Ù ØµÙˆØªÙŠ ØµØ§Ù„Ø­. Ø±Ø§Ø¬Ø¹ Console Ù„Ù…Ø¹Ø±ÙØ© Ø§Ù„Ø±ÙˆØ§Ø¨Ø· Ø§Ù„ØªÙŠ Ø¬ÙØ±Ù‘Ø¨Øª (Ø³ØªØ¬Ø¯ Ù‚Ø§Ø¦Ù…Ø©).`;
    reciterInfoEl.textContent = `${reciter.info} â€” Ù„Ù… Ù†ØªÙ…ÙƒÙ† Ù…Ù† Ø¥ÙŠØ¬Ø§Ø¯ Ù…Ù„Ù ØµÙˆØªÙŠ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹. Ø¬Ø±Ù‘Ø¨ ÙˆØ¶Ø¹ Ø±Ø§Ø¨Ø· mp3 Ù…Ø¨Ø§Ø´Ø± ÙÙŠ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø£Ùˆ Ø§Ø®ØªØ± Ù‚Ø§Ø±Ø¦Ù‹Ø§ Ø¢Ø®Ø±.`;
    announce("ÙØ´Ù„ ÙÙŠ Ø¥ÙŠØ¬Ø§Ø¯ Ù…Ù„Ù ØµÙˆØªÙŠ. Ø§ÙØªØ­ Console ÙˆØ§Ù†Ø³Ø® Ø£ÙˆÙ„ Ø±Ø§Ø¨Ø· Ø­Ø§ÙˆÙ„Ù†Ø§Ù‡.");
    console.error("[loadSurah] No working audio URL found. Ø­Ø§ÙˆÙ„ Ù‡Ø°Ù‡ Ø§Ù„Ø±ÙˆØ§Ø¨Ø· ÙÙŠ Console.");
  }
}

/* ========== ØªØ´ØºÙŠÙ„ ÙˆØ¥ÙŠÙ‚Ø§Ù ========== */
function togglePlayPause(){
  if (!audioEl.src){
    announce("Ù„Ù… ÙŠØªÙ… ØªØ­Ù…ÙŠÙ„ Ù…Ù„Ù ØµÙˆØªÙŠ. Ø§Ø®ØªØ± Ø³ÙˆØ±Ø© Ø£Ùˆ Ø¶Ø¹ Ø±Ø§Ø¨Ø· mp3 ÙÙŠ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª.");
    return;
  }
  if (audioEl.paused){
    audioEl.play().then(()=> { playPauseBtn.textContent = "â¸"; state.isPlaying = true; announce("ØªØ´ØºÙŠÙ„"); })
      .catch(err => { console.error("Play failed:", err); announce("ÙØ´Ù„ Ø§Ù„ØªØ´ØºÙŠÙ„ â€” ØªÙØ§Ø¹Ù„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø·Ù„ÙˆØ¨ Ø£Ùˆ CORS/Policy ÙŠÙ…Ù†Ø¹ Ø§Ù„ØªØ´ØºÙŠÙ„."); });
  } else {
    audioEl.pause(); playPauseBtn.textContent = "â–º"; state.isPlaying = false; announce("Ø¥ÙŠÙ‚Ø§Ù Ù…Ø¤Ù‚Øª");
  }
}
function stopPlayback(){ audioEl.pause(); audioEl.currentTime = 0; playPauseBtn.textContent = "â–º"; state.isPlaying = false; announce("ØªÙ… Ø§Ù„Ø¥ÙŠÙ‚Ø§Ù"); }
function onAudioEnded(){ if (state.repeatMode==="one"){ audioEl.currentTime=0; audioEl.play(); return; } if (state.autoAdvance||state.repeatMode==="all"){ const nextIdx=(state.selectedSurahIndex+1)%state.surahs.length; selectSurahByNumber(state.surahs[nextIdx].number); audioEl.play().catch(()=>{}); } else { state.isPlaying=false; playPauseBtn.textContent="â–º"; announce("Ø§Ù†ØªÙ‡Øª Ø§Ù„Ø³ÙˆØ±Ø©."); } }
function playPrevious(){ if (state.selectedSurahIndex<=0){ announce("Ù‡Ø°Ù‡ Ø£ÙˆÙ„ Ø³ÙˆØ±Ø©."); return;} selectSurahByNumber(state.surahs[state.selectedSurahIndex-1].number); audioEl.play().catch(()=>{}); }
function playNext(){ if (state.selectedSurahIndex>=state.surahs.length-1){ announce("Ù‡Ø°Ù‡ Ø¢Ø®Ø± Ø³ÙˆØ±Ø©."); return;} selectSurahByNumber(state.surahs[state.selectedSurahIndex+1].number); audioEl.play().catch(()=>{}); }

/* ========== Repeat / Theme / Search / Keyboard ========== */
function cycleRepeat(){ const order=["off","one","all"]; const next=(order.indexOf(state.repeatMode)+1)%order.length; state.repeatMode=order[next]; repeatBtn.setAttribute("aria-pressed", state.repeatMode!=="off"); repeatBtn.textContent = state.repeatMode==="off"? "ğŸ” Off" : state.repeatMode==="one"? "ğŸ”‚ One" : "ğŸ” All"; announce(`Repeat: ${state.repeatMode}`); }
function toggleTheme(){ const current=document.body.getAttribute("data-theme"); setTheme(current==="light"?"dark":"light"); }
function setTheme(t){ document.body.setAttribute("data-theme", t); themeToggle.textContent = t==="dark"?"â˜€ï¸":"ğŸŒ™"; localStorage.setItem("ql_theme", t); announce(`Theme: ${t}`); }
function onSearch(e){ const q=e.target.value.trim().toLowerCase(); const nodes=surahListEl.querySelectorAll(".surah"); nodes.forEach(node => { const num=node.getAttribute("data-number"); const s=state.surahs.find(x=>x.number===parseInt(num)); const hay=`${s.english} ${s.arabic} ${s.number}`.toLowerCase(); node.style.display = (q===""||hay.includes(q))? "" : "none"; }); }
function onKeyDown(e){ const active=document.activeElement; if (active && (active.tagName==="INPUT"||active.tagName==="TEXTAREA"||active.isContentEditable)) return; switch(e.key.toLowerCase()){ case " ": e.preventDefault(); togglePlayPause(); break; case "s": openSettingsBtn.click(); break; case "arrowleft": audioEl.currentTime = Math.max(0, audioEl.currentTime-5); break; case "arrowright": audioEl.currentTime = Math.min(audioEl.duration||0, audioEl.currentTime+5); break; case "arrowup": audioEl.volume = Math.min(1, audioEl.volume+0.05); volumeInput.value = audioEl.volume; break; case "arrowdown": audioEl.volume = Math.max(0, audioEl.volume-0.05); volumeInput.value = audioEl.volume; break; case "m": audioEl.muted = !audioEl.muted; announce(audioEl.muted ? "Muted" : "Unmuted"); break; case "n": playNext(); break; case "p": playPrevious(); break; default: break; } }
function announce(msg){ ariaStatus.textContent = msg; console.log("Announce:", msg); }

/* ========== Ø¨Ø¯Ø¡ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ========== */
document.addEventListener("DOMContentLoaded", init);

/* ========== Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ù…Ù‡Ù…Ø© Ø¹Ù†Ø¯ Ø§Ù„ÙØ´Ù„ Ø§Ù„Ù…Ø³ØªÙ…Ø± ==========
1) Ø§ÙØªØ­ DevTools -> Console ÙˆØ³ØªØ±Ù‰ Ø³Ø·ÙˆØ± [audio-test] Trying URL: ... Ø§Ù†Ø³Ø® Ø£ÙˆÙ„ Ø±Ø§Ø¨Ø· Ø­Ø§ÙˆÙ„ØªÙ‡ ÙˆØ§ÙØªØ­Ù‡ ÙÙŠ ØªØ¨ÙˆÙŠØ¨ Ø¬Ø¯ÙŠØ¯:
   - Ø¥Ù† Ø¸Ù‡Ø± 404 => Ø§Ù„Ù‚Ø§Ù„Ø¨/slug Ø®Ø§Ø·Ø¦: Ø¹Ø¯Ù‘Ù„ Ù‚Ø§Ù„Ø¨ Ø§Ù„ØµÙˆØª Ø£Ùˆ Ø¶Ø¹ Ø±Ø§Ø¨Ø· mp3 Ù…Ø¨Ø§Ø´Ø± ÙÙŠ Settings.
   - Ø¥Ù† Ø¸Ù‡Ø± 200 Ù„ÙƒÙ† Ù„Ù… ÙŠÙØ³Ù…Ø¹ ÙÙŠ ØµÙØ­ØªÙŠ => Ø£Ù„Ù‚Ù Ù†Ø¸Ø±Ø© Ø¹Ù„Ù‰ Network response headers Ø¥Ù† ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ Access-Control-Allow-Origin.
   - Ø¥Ù† ÙƒØ§Ù† Ø§Ù„Ø®Ø·Ø£ CORS ÙÙŠ Console => Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø¥ØµÙ„Ø§Ø­Ù‡ Ù…Ù† Ø¬Ù‡Ø© Ø§Ù„Ø¹Ù…ÙŠÙ„ Ø¥Ù„Ø§ Ø¥Ø°Ø§ Ø³Ù…Ø­ Ø§Ù„Ù…ØµØ¯Ø± Ø¨Ù€ CORS Ø£Ùˆ Ø§Ø³ØªØ®Ø¯Ù…Øª proxy Ù…Ù† Ø³ÙŠØ±ÙØ±Ùƒ.

2) Ø£ÙØ¶Ù„ Ø§Ø®ØªØ¨Ø§Ø± Ø³Ø±ÙŠØ¹:
   - Ø§ÙØªØ­ Settings ÙˆØ£Ù„ØµÙ‚ Ø±Ø§Ø¨Ø· mp3 Ù…Ø¨Ø§Ø´Ø± Ù…Ø¹Ø±ÙˆÙ (Ø£Ø­Ø¯ Ù…Ù„ÙØ§Øª mp3 ØµØ§Ù„Ø­) Ø«Ù… Ø¬Ø±Ø¨ Ø§Ù„ØªØ´ØºÙŠÙ„. Ø¥Ù† Ø§Ø´ØªØºÙ„ Ù‡Ø°Ø§ØŒ ÙØ§Ù„Ù…Ø´ÙƒÙ„Ø© ÙÙŠ Ù‚Ø§Ù„Ø¨/slug Ø£Ùˆ CORS Ù„Ù…ØµØ¯Ø± Ø§Ù„Ù…Ù„ÙØ§Øª.

3) Ø£Ø±Ø³Ù„ Ù„ÙŠ Ù‡Ù†Ø§:
   - Ø£ÙˆÙ„ Ø±Ø§Ø¨Ø· Ø­Ø§ÙˆÙ„ØªÙ‡ Ø§Ù„Ø°ÙŠ Ø·ÙØ¨Ø¹ ÙÙŠ Console (Ø³Ø£Ø­Ù„Ù„ Ù‡Ù„ 404 Ø£Ùˆ CORS).
   - Ø£Ùˆ Ø§Ù†Ø³Ø® ØµÙˆØ±Ø©/Ù†Øµ Ø§Ù„Ø®Ø·Ø£ Ù…Ù† Console.
   Ø³Ø£Ø­Ù„Ù‘Ù„ Ø§Ù„Ù†Ø§ØªØ¬ Ùˆ Ø£Ù‚Ø¯Ù‘Ù… ØªØ¹Ø¯ÙŠÙ„Ù‹Ø§ Ù…Ø®ØµØµÙ‹Ø§ (ØªØµØ­ÙŠØ­ slug Ø£Ùˆ Ù‚Ø§Ù„Ø¨ Ø§Ù„Ø±Ø§Ø¨Ø·) Ø£Ùˆ Ø£Ù‚ÙˆÙ„ Ù„Ùƒ ÙƒÙŠÙ ØªØ¶Ø¨Ø· CORS/proxy.

*/ 
{
	"folders": [
		{
			"path": "../../python progect/first progect"
		},
		{
			"path": "F:/Ù‚Ø±Ø§Ù† Ø§Ù„Ø­ØµØ±ÙŠ/TvQuran.com__Al-Hussary"
		}
	],
	"settings": {
		"python-envs.defaultEnvManager": "ms-python.python:system",
		"liveServer.settings.multiRootWorkspaceName": "TvQuran.com__Al-Hussary"
	}
}
<!doctype html>
<html lang="en" dir="ltr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>QuranListen â€” The World's Best Quran Listening Experience</title>

  <!-- Theme preconnect for faster CDN audio (if used) -->
  <link rel="preconnect" href="https://cdn.islamic.network" crossorigin>

  <!-- Styles -->
  <link rel="stylesheet" href="style.css">

  <!-- Small meta for progressive enhancement -->
  <meta name="description" content="Responsive, accessible Quran listening SPA with multiple reciters, murattal & mujawwad styles, advanced audio controls, search, dark mode, and keyboard navigation." />
</head>
<body class="app fade-in" data-theme="light">

  <header class="topbar" role="banner">
    <div class="brand" aria-hidden="false">
      <div class="logo" aria-hidden="true">ï·½</div>
      <div class="titles">
        <h1>QuranListen</h1>
        <p class="tagline">Beautiful, accessible Quran listening â€” murattal & mujawwad</p>
      </div>
    </div>

    <div class="controls" role="navigation" aria-label="Main controls">
      <label class="sr-only" for="search">Search Surah or Reciter</label>
      <input id="search" class="search" type="search" placeholder="Search surah, reciter or recitation type..." aria-label="Search surah, reciter or recitation type" />

      <select id="reciterSelect" aria-label="Choose reciter" class="select">
        <!-- Populated by JS -->
      </select>

      <select id="typeSelect" aria-label="Recitation type" class="select">
        <option value="murattal">Murattal (Clear, measured)</option>
        <option value="mujawwad">Mujawwad (Melodic)</option>
      </select>

      <button id="themeToggle" class="btn icon-btn" aria-pressed="false" aria-label="Toggle dark mode" title="Toggle dark / light mode">ğŸŒ™</button>
    </div>
  </header>

  <main class="main" role="main">
    <aside class="sidebar" role="complementary" aria-label="Surah list">
      <div class="panel">
        <h2>Surahs</h2>
        <div class="surah-list" id="surahList" tabindex="0" aria-label="List of surahs">
          <!-- Surah items injected by JS -->
        </div>
      </div>

      <div class="panel reciter-panel">
        <h3>Reciter Info</h3>
        <div id="reciterInfo" class="reciter-info" aria-live="polite">
          <!-- Selected reciter description filled by JS -->
        </div>

        <div class="reciter-grid" id="reciterGrid" aria-label="Reciters">
          <!-- Reciter cards populated by JS -->
        </div>

        <details>
          <summary>Audio Source Templates</summary>
          <p class="small">
            Use provided templates to fetch high-quality MP3 per-surah from trusted CDNs (example: Islamic.Network CDN).
            You can also paste a custom audio template URL in the settings panel (use {reciterId} and {surah} placeholders).
          </p>
          <ul class="small">
            <li><code>https://cdn.islamic.network/quran/audio/128/{reciterId}/{surah}.mp3</code> (recommended)</li>
            <li><code>https://download.quranicaudio.com/{reciterFolder}/{recitationType}/{surah}.mp3</code> (another option)</li>
          </ul>
        </details>
      </div>
    </aside>

    <section class="player-area" aria-label="Player section">
      <div class="card" id="nowPlaying" aria-live="polite">
        <div class="now-top">
          <div class="now-meta">
            <div class="surah-meta">
              <div id="surahNumber" class="surah-number">â€”</div>
              <div>
                <div id="surahName" class="surah-name">Select a surah</div>
                <div id="surahNameArabic" class="surah-arabic" aria-hidden="true"></div>
              </div>
            </div>

            <div class="recitation-meta">
              <div id="selectedReciter">â€”</div>
              <div id="selectedType" class="muted">â€”</div>
            </div>
          </div>

          <div class="art">
            <!-- Decorative Islamic-inspired pattern -->
            <svg width="86" height="86" viewBox="0 0 100 100" aria-hidden="true">
              <defs><linearGradient id="g" x1="0" x2="1"><stop offset="0" stop-color="#8fbf8f"/><stop offset="1" stop-color="#d4b255"/></linearGradient></defs>
              <circle cx="50" cy="50" r="46" fill="url(#g)"></circle>
            </svg>
          </div>
        </div>

        <!-- Player controls -->
        <div class="player-controls" role="region" aria-label="Audio player controls">
          <div class="big-controls">
            <button id="prevBtn" class="btn icon-btn" aria-label="Previous surah">âŸ¸</button>
            <button id="playPauseBtn" class="btn play-btn" aria-label="Play" title="Play (Space)">â–º</button>
            <button id="stopBtn" class="btn icon-btn" aria-label="Stop">â– </button>
            <button id="nextBtn" class="btn icon-btn" aria-label="Next surah">âŸ¹</button>
          </div>

          <div class="progress-row">
            <div class="time left" id="currentTime">0:00</div>
            <div class="progress" role="slider" aria-label="Seek" tabindex="0">
              <input id="progress" type="range" min="0" max="100" value="0" step="0.1" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0" />
            </div>
            <div class="time right" id="duration">0:00</div>
          </div>

          <div class="secondary-controls">
            <label class="small" for="volume">Vol</label>
            <input id="volume" type="range" min="0" max="1" step="0.01" value="0.95" aria-label="Volume" />

            <label class="small" for="speed">Speed</label>
            <select id="speed" aria-label="Playback speed">
              <option value="0.5">0.5x</option>
              <option value="0.75">0.75x</option>
              <option value="1" selected>1x</option>
              <option value="1.25">1.25x</option>
              <option value="1.5">1.5x</option>
              <option value="2">2x</option>
            </select>

            <div class="repeat-group" role="group" aria-label="Repeat">
              <button id="repeatBtn" class="btn icon-btn" aria-pressed="false" title="Repeat mode">ğŸ” Off</button>
            </div>

            <button id="openSettings" class="btn" aria-haspopup="dialog" aria-controls="settingsDialog">Settings</button>
          </div>
        </div>

        <!-- Visually hidden audio element for screen readers (but controls are custom) -->
        <audio id="audio" preload="auto" crossorigin="anonymous">
          <!-- Source elements will be populated by JavaScript -->
          your browser does not support the audio element.
        </audio>
      </div>

      <!-- Settings dialog (basic, accessible) -->
      <dialog id="settingsDialog" aria-labelledby="settingsTitle">
        <h3 id="settingsTitle">Player settings</h3>
        <form method="dialog" id="settingsForm">
          <label for="customTemplate">Custom audio template (use {reciterId} and {surah})</label>
          <input id="customTemplate" type="text" placeholder="https://cdn.example.com/audio/128/{reciterId}/{surah}.mp3" />

          <label for="autoAdvance">Auto-advance to next surah</label>
          <input id="autoAdvance" type="checkbox" />

          <label for="useLocalAudio">Use local audio files (folder: <code>sound/</code>)</label>
          <input id="useLocalAudio" type="checkbox" />

          <p id="localFilesStatus" class="small" aria-live="polite" style="margin-top:6px;">Checking local files...</p>

          <div class="dialog-actions">
            <button id="saveSettings" class="btn primary" type="submit">Save</button>
            <button id="cancelSettings" class="btn" type="button">Cancel</button>
          </div>
        </form>
      </dialog>

      <!-- Accessibility helper -->
      <div id="ariaStatus" class="sr-only" aria-live="polite"></div>
    </section>
  </main>

  <footer class="footer" role="contentinfo">
    <div>
      <small>Islamic-inspired design â€¢ No ads â€¢ Focused listening</small>
    </div>
    <div>
      <small>Keyboard: Space Play/Pause â€¢ â†/â†’ Seek â€¢ â†‘/â†“ Volume â€¢ S Settings</small>
    </div>
  </footer>

  <!-- App script -->
  <script src="app.js" defer></script>
</body>
</html>
:root{
  /* Theme variables for light and dark. Keep colors subtle Islamic-inspired greens & golds */
  --bg: #f7f9f8;
  --card: #ffffff;
  --muted: #6b6b6b;
  --text: #073B2D;
  --accent: #7fb07f; /* soft green */
  --accent-2: #d4b255; /* gold */
  --glass: rgba(255,255,255,0.6);
  --shadow: 0 6px 18px rgba(2,8,6,0.08);
  --radius: 12px;
  --focus: 3px solid rgba(127,176,127,0.25);
  --ease: cubic-bezier(.2,.9,.3,1);
  font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
  color-scheme: light;
}

[data-theme="dark"]{
  --bg: #02130f;
  --card: #041916;
  --muted: #9bb39e;
  --text: #e7f6ef;
  --accent: #6aa36a;
  --accent-2: #b98f34;
  --glass: rgba(10,20,18,0.4);
  --shadow: 0 8px 28px rgba(0,0,0,0.6);
  color-scheme: dark;
}

*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;
  background: linear-gradient(180deg, var(--bg), rgba(255,255,255,0)) fixed;
  color:var(--text);
  -webkit-font-smoothing:antialiased;
  -moz-osx-font-smoothing:grayscale;
  display:flex;
  flex-direction:column;
  min-height:100vh;
}

/* Fade-in animation on load for smoothness */
.fade-in{animation:fadeIn .6s var(--ease) both}
@keyframes fadeIn{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:none}}

/* Topbar */
.topbar{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:16px;
  padding:12px 20px;
  background: linear-gradient(90deg, rgba(127,176,127,0.06), rgba(212,178,85,0.03));
  border-bottom:1px solid rgba(0,0,0,0.04);
  position:sticky;
  top:0;
  z-index:10;
}

.brand{display:flex;align-items:center;gap:12px}
.logo{font-size:28px;background:linear-gradient(45deg,var(--accent),var(--accent-2));-webkit-background-clip:text;background-clip:text;color:transparent}
.titles h1{margin:0;font-size:1.1rem}
.tagline{margin:0;font-size:0.78rem;color:var(--muted)}

/* Header controls */
.controls{display:flex;gap:8px;align-items:center}
.search{padding:8px 12px;border-radius:10px;border:1px solid rgba(0,0,0,0.06);min-width:220px;transition:box-shadow .2s var(--ease)}
.search:focus{outline:none;box-shadow:var(--focus)}
.select{padding:8px;border-radius:10px;border:1px solid rgba(0,0,0,0.06);background:var(--card)}
.btn{padding:8px 12px;border-radius:10px;border:0;background:var(--accent);color:white;cursor:pointer;transition:transform .12s var(--ease),box-shadow .12s var(--ease)}
.btn:hover{transform:translateY(-2px);box-shadow:var(--shadow)}
.icon-btn{background:transparent;color:var(--text);padding:8px;border-radius:8px;border:1px solid rgba(0,0,0,0.06)}
.play-btn{font-size:18px;background:linear-gradient(90deg,var(--accent),var(--accent-2));color:#fff;padding:12px 18px;border-radius:14px;box-shadow:0 8px 18px rgba(127,176,127,0.12)}
.primary{background:var(--accent-2);}

/* Layout */
.main{display:flex;gap:20px;padding:22px;flex:1;align-items:flex-start}
.sidebar{width:320px;max-width:38vw;min-width:260px}
.panel{background:var(--card);padding:14px;border-radius:var(--radius);box-shadow:var(--shadow);margin-bottom:14px}
.surah-list{max-height:68vh;overflow:auto;padding:6px;display:grid;grid-template-columns:1fr 1fr;gap:6px}
.surah{
  padding:8px 10px;border-radius:8px;border:1px solid rgba(0,0,0,0.04);
  display:flex;align-items:center;gap:10px;cursor:pointer;background:linear-gradient(180deg,transparent,rgba(0,0,0,0.01));
  transition:transform .12s var(--ease),box-shadow .12s var(--ease),background .12s var(--ease);
}
.surah:hover,.surah:focus{transform:translateY(-4px);box-shadow:var(--shadow);outline:none}
.surah .num{font-weight:600;color:var(--accent-2);min-width:28px;text-align:center}
.surah .names{font-size:0.92rem}
.surah .arab{font-size:0.78rem;color:var(--muted)}

/* Player area */
.player-area{flex:1;min-width:320px}
.card{background:var(--card);padding:18px;border-radius:var(--radius);box-shadow:var(--shadow)}
.now-top{display:flex;align-items:center;justify-content:space-between;gap:16px}
.now-meta{display:flex;flex-direction:column;gap:8px}
.surah-meta{display:flex;gap:10px;align-items:center}
.surah-number{background:linear-gradient(90deg,var(--accent),var(--accent-2));color:white;border-radius:10px;padding:8px 10px;font-weight:700}
.surah-name{font-size:1.2rem;font-weight:700}
.surah-arabic{font-size:1rem;color:var(--accent);font-family: "Scheherazade", serif}
.recitation-meta{font-size:0.9rem;color:var(--muted);display:flex;flex-direction:column}

/* Reciter grid (new UX) */
.reciter-grid{
  display:grid;
  grid-template-columns:repeat(auto-fit, minmax(140px, 1fr));
  gap:10px;
  margin-top:12px;
}
.reciter-card{
  background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.01));
  border-radius:10px;
  padding:10px;
  display:flex;
  gap:10px;
  align-items:center;
  cursor:pointer;
  border:1px solid rgba(0,0,0,0.04);
  transition:transform .22s var(--ease), box-shadow .22s var(--ease), background .22s var(--ease);
}
.reciter-card.selected{ outline: 3px solid rgba(127,176,127,0.12); box-shadow: 0 18px 40px rgba(127,176,127,0.08); background: linear-gradient(180deg, rgba(127,176,127,0.03), rgba(212,178,85,0.02)); }
.reciter-card:hover{ transform: translateY(-6px); box-shadow: 0 12px 30px rgba(0,0,0,0.12); }
.reciter-avatar{ width:48px; height:48px; border-radius:8px; background:linear-gradient(90deg,var(--accent),var(--accent-2)); color:white; display:flex;align-items:center;justify-content:center; font-weight:700}
.reciter-meta{ display:flex; flex-direction:column; }
.reciter-name{ font-size:0.95rem; font-weight:700 }
.reciter-info{ font-size:0.78rem; color:var(--muted); }

/* Now-playing artwork and subtle animation */
.art{ transition: transform .45s cubic-bezier(.2,.9,.3,1); }
.art.playing{ transform: rotate(4deg) scale(1.02); box-shadow: 0 12px 30px rgba(0,0,0,0.12); }

/* Smooth controls */
.player-controls .big-controls button{ transition: transform .12s ease, box-shadow .12s ease }
.player-controls .big-controls button:active{ transform: scale(.98) }

/* subtle pulse on play when starting */
.pulse{ animation: pulse .9s ease; }
@keyframes pulse{ 0%{ transform: scale(1); }50%{ transform: scale(1.04); }100%{ transform: scale(1); } }

/* Player controls */
.player-controls{margin-top:16px;display:flex;flex-direction:column;gap:12px}
.big-controls{display:flex;gap:12px;align-items:center}
.progress-row{display:flex;align-items:center;gap:12px}
.progress{flex:1}
.progress input[type=range]{width:100%}
.time{font-size:0.9rem;color:var(--muted);min-width:44px;text-align:center}
.secondary-controls{display:flex;gap:10px;align-items:center;border-top:1px dashed rgba(0,0,0,0.03);padding-top:12px}

/* Footer */
.footer{padding:12px 22px;background:transparent;display:flex;justify-content:space-between;align-items:center;color:var(--muted);font-size:0.85rem}

/* Dialog */
dialog{border-radius:12px;border:0;padding:18px;box-shadow:var(--shadow);background:var(--card)}
.dialog-actions{display:flex;gap:8px;justify-content:flex-end;margin-top:12px}

/* Accessibility helpers */
.sr-only{position:absolute!important;height:1px;width:1px;overflow:hidden;clip:rect(1px,1px,1px,1px);white-space:nowrap;border:0;padding:0;margin:-1px}

/* Responsive */
@media (max-width:980px){
  .main{flex-direction:column;padding:16px}
  .sidebar{width:100%;max-width:100%}
  .surah-list{grid-template-columns:repeat(3,1fr)}
}
@media (max-width:560px){
  .surah-list{grid-template-columns:repeat(2,1fr)}
  .controls{flex-wrap:wrap}
  .search{min-width:140px}
}

/* Smooth hover transitions */
.surah, .btn, .select, .search {transition: all .15s var(--ease)}
